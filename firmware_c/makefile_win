# Makefile for ty71m firmware
#test temp TODO REMOVE
projectpath:=%cd%
toolchainpath=$(projectpath)\..\gcc-arm\bin

objfilepath=$(projectpath)\obj
outputpath=$(projectpath)\out

as:=arm-none-eabi-as.exe
cc:=arm-none-eabi-gcc.exe
ar:=arm-none-eabi-ar.exe
ld:=arm-none-eabi-ld.exe

asInFiles:=.\startup_NUC122.S
asOutFiles:=.\obj\startup_NUC122.O

ccInFiles:=main.c
ccOutFiles:=.\out\compiled.o
ccFlags:=-g --specs=nosys.specs -Wall -mcpu=cortex-m0 -mthumb -mfloat-abi=soft

ldInFiles:=$(ccOutFiles) $(asOutFiles)
ldOutFiles:=.\obj\firmware.elf
ldFlags:=-T.\gcc_arm.ld
ldLibDirs:=-L.\..\gcc-arm\arm-none-eabi\lib -L.\..\gcc-arm\lib\gcc\arm-none-eabi\8.2.1

Release: 
	@echo "Started assembling of startup file"
	$(as) -o$(asOutFiles) $(asInFiles) -mcpu=cortex-m0
	@echo "Started compilation of firmware"
	$(cc) -c -v $(ccInFiles) -I.\inc  -o $(ccOutFiles) $(ccFlags)
	@echo "Linking the object files from the previous steps"
	$(ld) $(ldFlags) $(ldInFiles) -o$(ldOutFiles) $(ldLibDirs)
clean:
	@echo "Path %cd%"
	@echo "Cleaning objectfiles"
	del /F /Q $(objfilepath)\*.*
	@echo "Cleaning outputfiles"
	del /F /Q $(outputpath)\*.*